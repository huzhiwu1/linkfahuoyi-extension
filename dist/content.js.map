{"version":3,"file":"content.js","sources":["webpack://linkfahuoyi-exension/./src/content/index.ts","webpack://linkfahuoyi-exension/./src/types/index.ts","webpack://linkfahuoyi-exension/webpack/bootstrap","webpack://linkfahuoyi-exension/webpack/startup"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.PlatformCode = void 0;\r\nvar types_1 = require(\"../types\");\r\nvar PlatformCode;\r\n(function (PlatformCode) {\r\n    PlatformCode[PlatformCode[\"\\u6DD8\\u7CFB\\u53CA\\u5176\\u4ED6\\u5E73\\u53F0\\u8BA2\\u5355\\u6A21\\u677F\"] = 0] = \"\\u6DD8\\u7CFB\\u53CA\\u5176\\u4ED6\\u5E73\\u53F0\\u8BA2\\u5355\\u6A21\\u677F\";\r\n    PlatformCode[PlatformCode[\"\\u62FC\\u591A\\u591A\\u8BA2\\u5355\\u6A21\\u677F\"] = 1] = \"\\u62FC\\u591A\\u591A\\u8BA2\\u5355\\u6A21\\u677F\";\r\n    PlatformCode[PlatformCode[\"\\u4EAC\\u4E1C\\u8BA2\\u5355\\u6A21\\u677F\"] = 2] = \"\\u4EAC\\u4E1C\\u8BA2\\u5355\\u6A21\\u677F\";\r\n})(PlatformCode = exports.PlatformCode || (exports.PlatformCode = {}));\r\nwindow.addEventListener(\"message\", function (res) {\r\n    if (res.data.action === \"StartPrint\") {\r\n        chrome.storage.local.get({ list: [] }, function (storage) {\r\n            // @ts-ignore\r\n            if (storage.list.length == 0 || !storage.list[0].wayCompanyId || !storage.list[0].waybillTemplateList.some(function (item) { return item; })) {\r\n                alert(\"请选择快递模板\");\r\n                return;\r\n            }\r\n            var _a = res.data.value, wayCompanyId = _a.wayCompanyId, waybillNo = _a.waybillNo, orderNo = _a.orderNo, platform = _a.platform;\r\n            if (!waybillNo && (!wayCompanyId || !orderNo || ![0, 1, 2].includes(Number(platform)))) {\r\n                alert(\"参数传递错误\");\r\n                return;\r\n            }\r\n            chrome.runtime.sendMessage({ action: types_1.StartPrint, value: res.data.value }, function (response) {\r\n            });\r\n        });\r\n    }\r\n});\r\nvar SelectOptions;\r\n(function (SelectOptions) {\r\n    SelectOptions[\"waybillNo\"] = \"waybillNo\";\r\n    SelectOptions[\"orderOriginalId\"] = \"orderOriginalId\";\r\n})(SelectOptions || (SelectOptions = {}));\r\nvar printWayBillByOld = function (waybillNo, wayCompanyId) {\r\n    chrome.storage.local.get({ list: [], isAutoEmit: false }, function (res) {\r\n        // 选择使用旧单号打印\r\n        var oldOptionDom = document.querySelectorAll(\".form-group.mr20>.radio-inline\")[1];\r\n        var waybillNoBtn = document.querySelector(\".form-group>.form-control.original-id-input-label>option[value=waybillNo]\");\r\n        var selectDom = document.querySelector(\"select.form-control.original-id-input-label\");\r\n        var inputDom = document.querySelector(\".form-group>.form-control.original-id-input\");\r\n        var serachBtn = document.querySelector(\".form-group>.btn.btn-primary[type=button]\");\r\n        var printDom = document.querySelector(\"#elContainer>div>.form-inline.panel-border.p15.search-panel>div[class]>.form-group.mr20[style]>select.form-control\");\r\n        var autoDom = document.querySelectorAll(\"#elContainer>div>.form-inline.panel-border.p15.search-panel>div.mt10>div.form-group.mr20>select.form-control\")[1];\r\n        var printId;\r\n        // @ts-ignore\r\n        res.list.forEach(function (item) {\r\n            if (item.wayCompanyId === wayCompanyId) {\r\n                printId = item.printId;\r\n            }\r\n        });\r\n        // 1.选择旧单号打印\r\n        oldOptionDom.click();\r\n        // 2.选择打单模板\r\n        waybillNoBtn.selected = true;\r\n        selectDom.value = SelectOptions.waybillNo;\r\n        // @ts-ignore\r\n        selectDom.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        // 3.选择打印机\r\n        printDom.value = printId;\r\n        printDom.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        // 4.自动发货\r\n        autoDom.value = \"true\";\r\n        autoDom.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        // 5.自己联系快递公司\r\n        var bySelf = document.querySelectorAll(\"#elContainer>div>.form-inline.panel-border.p15.search-panel>div.mt10>div.form-group.mr20>select.form-control\")[2];\r\n        bySelf.value = \"OFFLINE\";\r\n        bySelf.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        // 6.输入运单号\r\n        // selectDom.__reactEventHandlers$8wsw7c8olk.onChange({ target: { value: SelectOptions.waybillNo } })\r\n        inputDom.value = waybillNo;\r\n        serachBtn.click();\r\n    });\r\n};\r\nvar printWayBillByNew = function (_a) {\r\n    var orderNo = _a.orderNo, wayCompanyId = _a.wayCompanyId, platform = _a.platform;\r\n    // console.log(orderNo, wayCompanyId, platform)\r\n    // 根据快递公司的companyId选择相应的配置\r\n    chrome.storage.local.get({ list: [], isAutoEmit: false }, function (res) {\r\n        // console.log(res, 'res') //res:{isAutoEmit:boolean,list:[{waybillCompanyId:\"\",waybillTemplateList:[x,x,x]}]}\r\n        var waybillTemplate;\r\n        var printId;\r\n        // @ts-ignore\r\n        res.list.forEach(function (item) {\r\n            if (item.wayCompanyId === wayCompanyId) {\r\n                waybillTemplate = item.waybillTemplateList[platform];\r\n                printId = item.printId;\r\n            }\r\n        });\r\n        var newOrderBtn = document.querySelector(\".form-group.mr20>.radio-inline.mr10\");\r\n        var wayTemplateSelect = document.querySelector(\".form-group.mr20>.form-control.waybill-template-select\");\r\n        // let orderBtn = document.querySelector(\".form-group>.form-control.original-id-input-label>option[value=orderOriginalId]\") as HTMLOptionElement\r\n        var selectDom = document.querySelector(\"select.form-control.original-id-input-label\");\r\n        var inputDom = document.querySelector(\".form-group>.form-control.original-id-input\");\r\n        var searchDom = document.querySelector(\".form-group>.btn.btn-primary\");\r\n        var printDom = document.querySelector(\"#elContainer>div>.form-inline.panel-border.p15.search-panel>div[class]>.form-group.mr20[style]>select.form-control\");\r\n        var autoDom = document.querySelectorAll(\"#elContainer>div>.form-inline.panel-border.p15.search-panel>div.mt10>div.form-group.mr20>select.form-control\")[1];\r\n        //1.点击 获取新单号打印\r\n        newOrderBtn.click();\r\n        //2.选择快递单模板\r\n        wayTemplateSelect.value = waybillTemplate + \"\";\r\n        wayTemplateSelect.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        //3.点击订单编号\r\n        selectDom.value = SelectOptions.orderOriginalId;\r\n        // @ts-ignore\r\n        selectDom.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        // 4. 选择打印机\r\n        printDom.value = printId;\r\n        printDom.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        // orderBtn.click()\r\n        // 5.自动发货\r\n        autoDom.value = \"true\";\r\n        autoDom.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        // 6.自己联系快递公司\r\n        var bySelf = document.querySelectorAll(\"#elContainer>div>.form-inline.panel-border.p15.search-panel>div.mt10>div.form-group.mr20>select.form-control\")[2];\r\n        bySelf.value = \"OFFLINE\";\r\n        bySelf.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        //7.输入订单编号\r\n        inputDom.value = orderNo;\r\n        //8.点击搜索并打印\r\n        searchDom.click();\r\n    });\r\n};\r\n//发货易页面\r\nchrome.runtime.onMessage.addListener(function (message, sender, response) {\r\n    if (message.action === types_1.Print) {\r\n        if (message.value.waybillNo) {\r\n            printWayBillByOld(message.value.waybillNo, message.value.wayCompanyId);\r\n        }\r\n        else {\r\n            var _a = message.value, orderNo = _a.orderNo, wayCompanyId = _a.wayCompanyId, platform = _a.platform;\r\n            printWayBillByNew({ orderNo: orderNo, wayCompanyId: wayCompanyId, platform: platform });\r\n        }\r\n    }\r\n});\r\n// 拿到打印机\r\nchrome.runtime.onConnect.addListener(function (port) {\r\n    if (port.name === \"getPrinter\") {\r\n        port.onMessage.addListener(function (msg) {\r\n            console.log(msg, ' contentmsg');\r\n            if (msg.action === \"getPrint\") {\r\n                console.log(1);\r\n                // @ts-ignore\r\n                var options = document.querySelectorAll(\"#elContainer>div>.form-inline.panel-border.p15.search-panel>div[class]>.form-group.mr20[style]>select.form-control>option\");\r\n                // console.log(2)\r\n                // console.log(options, options[0].value, '3')\r\n                var arr = [];\r\n                for (var i = 0; i < options.length; i++) {\r\n                    arr.push(options[i].value);\r\n                }\r\n                port.postMessage(arr);\r\n            }\r\n        });\r\n    }\r\n});\r\n// 厂家content.js页面\r\nchrome.runtime.onMessage.addListener(function (message, sender, response) {\r\n    if (message.action === \"newWaybillNo\") {\r\n        window.postMessage(message, \"*\");\r\n    }\r\n});\r\n// inject.js\r\nvar startPrintWayBill = function (params) {\r\n    // 通知content.js触发事件\r\n    window.postMessage({ action: \"StartPrint\", value: params }, \"*\");\r\n    return new Promise(function (resolve, reject) {\r\n        // @ts-ignore\r\n        window.onmessage = function (res) {\r\n            if (res.data.action === \"newWaybillNo\") {\r\n                resolve(res.data.value);\r\n            }\r\n        };\r\n    });\r\n};\r\nfunction injectCustomjs() {\r\n    var temp = document.createElement(\"script\");\r\n    temp.innerHTML = \"window.startPrintWayBill=\" + startPrintWayBill;\r\n    document.body.appendChild(temp);\r\n    var tbodyDom = document.querySelector(\"#elContainer>div>table>tbody\");\r\n    if (tbodyDom) {\r\n        var observe = new MutationObserver(function (mutations, observe) {\r\n            var td = mutations[0].addedNodes[0].childNodes[3];\r\n            if (!td)\r\n                return;\r\n            var tdObserve = new MutationObserver(function (mutations, observe) {\r\n                mutations.forEach(function (item) {\r\n                    item.addedNodes.forEach(function (node) {\r\n                        if (node.nodeName == \"DIV\") {\r\n                            var text = node.childNodes[2].textContent;\r\n                            console.log(text, 'text');\r\n                            // window.postMessage({ action: \"newWaybillNo\", value: text }, \"*\")\r\n                            // 从发货易页面发消息给bg\r\n                            chrome.runtime.sendMessage({ action: \"newWaybillNo\", value: text }, function (res) {\r\n                            });\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n            tdObserve.observe(td, {\r\n                childList: true,\r\n            });\r\n        });\r\n        observe.observe(tbodyDom, {\r\n            childList: true,\r\n        });\r\n    }\r\n}\r\ninjectCustomjs();\r\n","\"use strict\";\r\n// //  快递模板列表下载是否完成\r\n// export const WaybillTemplateComplete = \"waybillTemplateComplete\"\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Print = exports.StartPrint = void 0;\r\n// // 让popup获取waybillTemplate\r\n// export const GetWaybillTemplate = \"getWaybillTemplate\"\r\nexports.StartPrint = \"StartPrint\";\r\nexports.Print = \"Print\";\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module\n// This entry module is referenced by other modules so it can't be inlined\n__webpack_require__(\"./src/content/index.ts\");\n"],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;;;;;;;;AChNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;;;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtBA;AACA;AACA;AACA;;A","sourceRoot":""}